<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sign in ‚Äî ScaleVest</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:Inter}
body{margin:0;color:#fff;overflow-x:hidden;}

/* VIDEO BG */
#bgVideo{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:-2;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:rgba(10,15,25,.45);
  z-index:-1;
}

/* AUTH BUTTONS */
.auth-btn{
  display:flex;
  align-items:center;
  gap:12px;
  width:100%;
  padding:13px 16px;
  margin-bottom:12px;
  border-radius:10px;
  border:1px solid #e5e7eb;
  background:#fff;
  font-weight:600;
  cursor:pointer;
  color:#000;
  font-size:14px;
}
.auth-btn:hover{background:#f9fafb}

/* MODALS */
.modal-overlay, .email-overlay{
  position:fixed;
  inset:0;
  display:flex;
  justify-content:center;
  align-items:center;
  z-index: 50;
}
.email-overlay{
  background:rgba(0,0,0,.6);
  backdrop-filter:blur(8px);
  display:none;
  z-index:100;
}
.email-glass{
  width:380px;
  padding:28px;
  border-radius:20px;
  background:rgba(255,255,255,.15);
  backdrop-filter:blur(20px);
  border: 1px solid rgba(255,255,255,0.2);
}
.email-glass h3{margin-top:0;color:#fff;font-size: 22px;}
.email-glass p{font-size: 13px; margin-bottom: 15px;}
.email-glass input{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
  border:none;
  background:rgba(255,255,255,.2);
  color:#fff;
  font-size:14px;
}
.email-glass input::placeholder{color:rgba(255,255,255,.6)}
.email-glass button{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:#fff;
  font-weight:600;
  cursor:pointer;
  font-size:14px;
  margin-top: 5px;
}
.email-glass button:hover{background:#1d4ed8}

ul{
  margin:6px 0 14px 14px;
  padding:0;
  font-size:12px;
  line-height:1.6;
  color:#fff;
}

.modal{
  width:900px;
  height:520px;
  background:#fff;
  border-radius:16px;
  display:flex;
  overflow:hidden;
  box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
}
.modal-left{
  width:50%;
  background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  position:relative;
}
.modal-left::after{
  content:"";
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.25);
}
.overlay-text{
  position:relative;
  z-index:2;
  padding:42px;
  color:#fff;
}
.modal-right{
  width:50%;
  padding:40px;
  color:#000;
}
.modal-right h3{margin-top:0;font-size:24px}
.modal-right p{font-size:14px;color:#6b7280}

.divider{
  text-align:center;
  margin:18px 0;
  position:relative;
}
.divider span{
  background:#fff;
  padding:0 10px;
  font-size:12px;
  color:#6b7280;
}
.divider::before{
  content:"";
  position:absolute;
  top:50%;
  left:0;
  right:0;
  height:1px;
  background:#e5e7eb;
  z-index:-1;
}

.error-msg{
  background:rgba(239,68,68,.2);
  border:1px solid rgba(239,68,68,0.5);
  color:#ff9999;
  padding:10px;
  border-radius:8px;
  font-size:13px;
  margin-bottom:12px;
  display:none;
}
</style>
</head>

<body>

<video id="bgVideo" autoplay muted loop playsinline>
  <source src="loginpage.mp4" type="video/mp4">
</video>

<div class="modal-overlay">
  <div class="modal">
    <div class="modal-left">
      <div class="overlay-text">
        <h2>Verified ‚Ä¢ Secure ‚Ä¢ Scalable</h2>
        <p>Join thousands of businesses scaling with confidence</p>
      </div>
    </div>

    <div class="modal-right">
      <h3 id="authTitle">New to ScaleVest?</h3>
      <p id="authSubtitle">Create an account to get started</p>

      <p id="authSwitch">
        Already have an account?
        <span style="color:#2563eb; font-weight:600; cursor:pointer;" onclick="switchToSigninUI()">Sign in</span>
      </p>

<button class="auth-btn" onclick="googleLogin()">
    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
    Continue with Google
</button>

<button class="auth-btn" onclick="emailAuthHandler()">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M3 8L10.8906 13.2604C11.5624 13.7083 12.4376 13.7083 13.1094 13.2604L21 8M5 19H19C20.1046 19 21 18.1046 21 17V7C21 5.89543 20.1046 5 19 5H5C3.89543 5 3 5.89543 3 7V17C3 18.1046 3.89543 19 5 19Z" stroke="#374151" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    Continue with Email
</button>
    </div>
  </div>
</div>

<div class="email-overlay" id="signupModal">
  <div class="email-glass">
    <h3>Create account</h3>
    <div class="error-msg" id="signupError"></div>
    <input id="signupEmail" type="email" placeholder="Email" autocomplete="email">
    <input id="signupPassword" type="password" placeholder="Password" autocomplete="new-password" oninput="checkPasswordRules()">
    <ul>
      <li id="rule_length">‚ùå At least 6 characters</li>
      <li id="rule_number">‚ùå Contains a number</li>
      <li id="rule_special">‚ùå Contains a special character</li>
    </ul>
    <button onclick="emailSignup()">Continue to Mobile</button>
    <p style="text-align:center;font-size:12px;margin-top:12px;color:#fff;">
      <span style="cursor:pointer" onclick="closeModals()">‚Üê Back</span>
    </p>
  </div>
</div>

<div class="email-overlay" id="mobileModal">
  <div class="email-glass">
    <h3>Verify Mobile</h3>
    <p>Please enter your mobile number for security verification.</p>
    <div class="error-msg" id="mobileError"></div>
    <input id="mobileNumber" type="tel" placeholder="+1 123 456 7890">
    <div id="recaptcha-container"></div>
    <button onclick="sendOTP()">Send OTP</button>
    <p style="text-align:center;font-size:12px;margin-top:12px;color:#fff;">
      <span style="cursor:pointer" onclick="mobileModal.style.display='none'; signupModal.style.display='flex';">‚Üê Back</span>
    </p>
  </div>
</div>

<div class="email-overlay" id="otpModal">
  <div class="email-glass">
    <h3>Enter Code</h3>
    <p>We've sent a 6-digit code to your phone.</p>
    <div class="error-msg" id="otpError"></div>
    <input id="otpCode" type="number" placeholder="000000">
    <button onclick="verifyOTPAndSignup()">Verify & Create Account</button>
    <p style="text-align:center;font-size:12px;margin-top:12px;color:#fff;">
      <span style="cursor:pointer" onclick="otpModal.style.display='none'; mobileModal.style.display='flex';">‚Üê Resend SMS</span>
    </p>
  </div>
</div>

<div class="email-overlay" id="signinModal">
  <div class="email-glass">
    <h3>Sign in</h3>
    <div class="error-msg" id="signinError"></div>
    <input id="signinEmail" type="email" placeholder="Email" autocomplete="email">
    <input id="signinPassword" type="password" placeholder="Password" autocomplete="current-password">
    <button onclick="emailSignin()">Sign in</button>
    <p style="text-align:right;font-size:12px;margin-top:8px;">
      <span style="cursor:pointer;color:#93c5fd" onclick="forgotPassword()">Forgot password?</span>
    </p>
    <div class="divider"><span>or</span></div>
    <button class="auth-btn" onclick="googleLogin()"><span>üîµ</span> Google Sign-In</button>
    <p style="text-align:center;font-size:12px;margin-top:12px;color:#fff;">
      <span style="cursor:pointer" onclick="closeModals()">‚Üê Back</span>
    </p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
// 1. Initialize Firebase
firebase.initializeApp({
  apiKey: "AIzaSyD6PdrKp2XLfRqjC587lMpdKTaWD4MBens",
  authDomain: "scalevest-163a0.firebaseapp.com",
  projectId: "scalevest-163a0"
});

const auth = firebase.auth();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

// Globals for multi-step flow
let isAuthFlowActive = false;
let tempEmail = "";
let tempPassword = "";
let confirmationResult = null;

// Initialize Invisible ReCaptcha for Phone Auth
window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
  'size': 'invisible'
});

/* UI NAVIGATION */
function emailAuthHandler(){ 
  signupModal.style.display="flex";
  signupError.style.display="none";
}
function switchToSigninUI(){
  signupModal.style.display="none";
  signinModal.style.display="flex";
  signinError.style.display="none";
}
function closeModals(){
  signupModal.style.display="none";
  signinModal.style.display="none";
  mobileModal.style.display="none";
  otpModal.style.display="none";
}

/* PASSWORD VALIDATION */
function checkPasswordRules(){
  const p = signupPassword.value;
  rule_length.innerText=(p.length>=6?"‚úÖ":"‚ùå")+" At least 6 characters";
  rule_number.innerText=(/\d/.test(p)?"‚úÖ":"‚ùå")+" Contains a number";
  rule_special.innerText=(/[!@#$%^&*]/.test(p)?"‚úÖ":"‚ùå")+" Contains a special character";
}
function validPassword(p){
  return p.length>=6 && /\d/.test(p) && /[!@#$%^&*]/.test(p);
}
function showError(elementId, message){
  const el = document.getElementById(elementId);
  el.innerText = message;
  el.style.display = "block";
}

/* STEP 1: CAPTURE EMAIL & PASS */
async function emailSignup() {
  tempEmail = signupEmail.value.trim();
  tempPassword = signupPassword.value;

  if (!tempEmail) { showError('signupError', 'Please enter email'); return; }
  if (!validPassword(tempPassword)) { showError('signupError', 'Invalid password'); return; }

  signupModal.style.display = "none";
  mobileModal.style.display = "flex";
}

/* STEP 2: SEND PHONE OTP */
async function sendOTP() {
  const phone = mobileNumber.value.trim();
  if (!phone.startsWith('+')) {
    showError('mobileError', 'Enter full number with country code (e.g., +1)');
    return;
  }

  try {
    const appVerifier = window.recaptchaVerifier;
    confirmationResult = await auth.signInWithPhoneNumber(phone, appVerifier);
    mobileModal.style.display = "none";
    otpModal.style.display = "flex";
  } catch (err) {
    showError('mobileError', err.message);
  }
}

/* STEP 3: VERIFY OTP AND FINALIZE SIGNUP */
async function verifyOTPAndSignup() {
  const code = otpCode.value.trim();
  isAuthFlowActive = true;

  try {
    // Confirm OTP first
    await confirmationResult.confirm(code);
    
    // Create Email/Password account after mobile is verified
    await auth.createUserWithEmailAndPassword(tempEmail, tempPassword);
    
    window.location.href = "business-side.html";
  } catch (err) {
    isAuthFlowActive = false;
    showError('otpError', "Verification failed: " + err.message);
  }
}

/* SIGN IN LOGIC */
async function emailSignin() {
  const email = signinEmail.value.trim();
  const password = signinPassword.value;

  if (!email || !password) { showError('signinError', 'Fields missing'); return; }

  isAuthFlowActive = true;
  try {
    await auth.signInWithEmailAndPassword(email, password);
    window.location.href = "mainbusinesshub.html";
  } catch (err) {
    isAuthFlowActive = false;
    showError('signinError', err.message);
  }
}

/* SOCIALS */
async function googleLogin() {
  isAuthFlowActive = true;
  try {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
    window.location.href = "mainbusinesshub.html";
  } catch (err) { isAuthFlowActive = false; alert(err.message); }
}

async function facebookLogin() {
  isAuthFlowActive = true;
  try {
    const provider = new firebase.auth.FacebookAuthProvider();
    await auth.signInWithPopup(provider);
    window.location.href = "mainbusinesshub.html";
  } catch (err) { isAuthFlowActive = false; alert(err.message); }
}

async function appleLogin() {
  isAuthFlowActive = true;
  try {
    const provider = new firebase.auth.OAuthProvider('apple.com');
    await auth.signInWithPopup(provider);
    window.location.href = "mainbusinesshub.html";
  } catch (err) { isAuthFlowActive = false; alert(err.message); }
}

/* FORGOT PASSWORD */
async function forgotPassword() {
  const email = signinEmail.value.trim();
  if (!email) { showError('signinError', 'Enter email first'); return; }
  try {
    await auth.sendPasswordResetEmail(email);
    showError('signinError', '‚úÖ Reset email sent!');
  } catch (err) { showError('signinError', err.message); }
}

/* AUTH STATE LISTENER */
auth.onAuthStateChanged(user => {
  if (isAuthFlowActive) return;
  if (user) { window.location.href = "mainbusinesshub.html"; }
});
</script>

</body>
</html>
