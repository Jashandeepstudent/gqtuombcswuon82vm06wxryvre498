<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Working Barcode Scanner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial;
  background: #111;
  color: white;
  text-align: center;
}

#video {
  width: 100%;
  max-width: 600px;
  border: 3px solid lime;
  border-radius: 12px;
  margin-top: 10px;
}

button {
  margin: 10px;
  padding: 14px 20px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  background: lime;
  color: black;
  cursor: pointer;
}

#log {
  margin: 10px;
  background: #222;
  padding: 10px;
  height: 150px;
  overflow-y: auto;
  text-align: left;
}
</style>
</head>

<body>

<h2>üì∑ Barcode Scanner</h2>

<video id="video" playsinline></video>

<br>
<button onclick="startScanner()">‚ñ∂ Start Scanner</button>
<button onclick="stopScanner()">‚õî Stop</button>

<div id="log"></div>

<script type="module">
import { BrowserMultiFormatReader } 
from "https://cdn.jsdelivr.net/npm/@zxing/browser@0.0.10/esm/index.min.js";

let codeReader;
let active = false;

function log(msg) {
  const div = document.createElement("div");
  div.textContent = msg;
  document.getElementById("log").prepend(div);
}

async function startScanner() {
  try {
    log("‚è≥ Starting camera...");

    codeReader = new BrowserMultiFormatReader();
    const video = document.getElementById("video");

    const devices = await navigator.mediaDevices.enumerateDevices();
    const cameras = devices.filter(d => d.kind === "videoinput");

    if (!cameras.length) {
      log("‚ùå No camera found");
      return;
    }

    const backCam =
      cameras.find(c => c.label.toLowerCase().includes("back")) || cameras[0];

    await codeReader.decodeFromVideoDevice(
      backCam.deviceId,
      video,
      (result, err) => {
        if (result && !active) {
          active = true;
          log("‚úÖ SCANNED: " + result.text);

          setTimeout(() => active = false, 1200);
        }
      }
    );

    log("‚úÖ Camera started");

  } catch (e) {
    log("‚ùå ERROR: " + e.message);
  }
}

function stopScanner() {
  if (codeReader) {
    codeReader.reset();
    log("‚õî Scanner stopped");
  }
}
</script>

</body>
</html>
